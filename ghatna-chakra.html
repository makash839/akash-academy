<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghatna Chakra Mock Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; }
        .hidden-all { display: none !important; }

        /* Theme Colors */
        .gc-blue { background-color: #003366; }
        .gc-orange { background-color: #FF9933; }
        .gc-green { background-color: #28a745; }

        /* Password Page Styling */
        .password-container {
            background: linear-gradient(135deg, #003366 0%, #004080 50%, #0059b3 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .password-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }

        .password-header {
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .password-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FF9933 0%, #FF9933 33%, #ffffff 33%, #ffffff 66%, #138808 66%, #138808 100%);
        }

        .password-body {
            padding: 35px 30px;
        }

        .password-input {
            width: 100%;
            padding: 15px 15px 15px 50px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .password-input:focus {
            border-color: #003366;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 51, 102, 0.1);
        }

        .unlock-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Question Palette */
        .palette-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            background: white;
            color: #333;
            font-weight: bold;
            cursor: pointer;
        }

        .palette-not-visited { background: #f8f9fa; border-color: #adb5bd; color: #6c757d; }
        .palette-not-answered { background: #dc3545; border-color: #dc3545; color: white; }
        .palette-answered { background: #28a745; border-color: #28a745; color: white; }
        .palette-marked { background: #6f42c1; border-color: #6f42c1; color: white; }
        .palette-current { box-shadow: 0 0 0 3px #FF9933; transform: scale(1.1); }

        /* Option Styling */
        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .option-label.selected { background: #e3f2fd; border-color: #2196f3; }

        .timer-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-family: monospace;
        }

        .btn-nta { padding: 10px 20px; border-radius: 4px; font-weight: 600; cursor: pointer; }
        .btn-save-next { background: #28a745; color: white; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="passwordOverlay" class="password-container">
        <div class="password-card">
            <div class="password-header">
                <h1 class="text-white text-2xl font-bold">GHATNA CHAKRA</h1>
                <p class="text-blue-200 text-sm mt-1">Excellence in Assessment</p>
            </div>
            <div class="password-body">
                <h2 class="text-center text-gray-800 text-lg font-semibold mb-6">Secure Login</h2>
                <div class="relative mb-4">
                    <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-blue-900"></i>
                    <input type="password" id="sitePass" class="password-input" placeholder="Enter Password">
                </div>
                <button onclick="checkPass()" class="unlock-btn">
                    <i class="fas fa-unlock-alt"></i>Access Test
                </button>
                <div id="passError" class="hidden text-red-500 text-sm mt-3 text-center">Incorrect password!</div>
            </div>
        </div>
    </div>

    <div id="loadingSection" class="hidden-all min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-900 border-solid mx-auto mb-4"></div>
            <p class="text-xl font-semibold">Loading Questions...</p>
        </div>
    </div>

    <div id="subjectSection" class="hidden-all min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="gc-orange text-white p-4 text-center">
                <h2 class="text-xl font-bold">Select Subject</h2>
            </div>
            <div class="p-6 space-y-4">
                <select id="mainSubject" onchange="updateSubSubjects()" class="w-full p-3 border-2 rounded-lg">
                    <option value="">-- Select Subject --</option>
                </select>
                <div id="subSubjectContainer" class="hidden">
                    <select id="subSubject" class="w-full p-3 border-2 rounded-lg">
                        <option value="">-- All Topics --</option>
                    </select>
                </div>
                <select id="questionCount" class="w-full p-3 border-2 rounded-lg">
                    <option value="10">10 Questions</option>
                    <option value="25">25 Questions</option>
                    <option value="50">50 Questions</option>
                    <option value="all">All Available</option>
                </select>
                <button onclick="startExam()" class="w-full gc-blue text-white py-3 rounded-lg font-bold hover:bg-blue-900">Start Exam</button>
            </div>
        </div>
    </div>

    <div id="instructionSection" class="hidden-all">
        <div class="gc-blue text-white p-4 text-center">
            <h1 class="text-2xl font-bold">GHATNA CHAKRA</h1>
        </div>
        <div class="max-w-4xl mx-auto p-6 bg-white mt-6 shadow rounded-lg">
            <h3 class="text-xl font-bold mb-4">Instructions:</h3>
            <ul class="list-disc list-inside space-y-2 mb-6 text-gray-700">
                <li>Total duration depends on the number of questions.</li>
                <li>Marking: +1 for Correct, -0.25 for Wrong.</li>
                <li>Do not refresh the page during the exam.</li>
            </ul>
            <label class="flex items-center gap-3 mb-6 cursor-pointer">
                <input type="checkbox" id="declaration" class="w-5 h-5">
                <span>I have read and understood the instructions.</span>
            </label>
            <button onclick="proceedToExam()" class="w-full py-3 gc-blue text-white rounded font-bold">PROCEED</button>
        </div>
    </div>

    <div id="examSection" class="hidden-all">
        <div class="gc-blue text-white p-3">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <h1 class="text-lg font-bold">GHATNA CHAKRA</h1>
                <div class="timer-box" id="timer">00:00:00</div>
            </div>
        </div>
        <div class="max-w-7xl mx-auto p-4 flex flex-col lg:flex-row gap-4">
            <div class="flex-1 bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">Question <span id="qNumber">1</span>:</h3>
                <div id="questionText" class="text-gray-800 mb-6 text-lg"></div>
                <div id="optionsContainer" class="space-y-3"></div>
                <div class="mt-8 flex flex-wrap gap-2">
                    <button onclick="saveAndNext()" class="btn-nta btn-save-next">Save & Next</button>
                    <button onclick="clearResponse()" class="btn-nta bg-gray-500 text-white">Clear</button>
                    <button onclick="markReviewAndNext()" class="btn-nta bg-purple-600 text-white">Mark Review</button>
                </div>
            </div>
            <div class="lg:w-80 bg-white rounded-lg shadow p-4">
                <h4 class="font-bold border-b pb-2 mb-4">Question Palette</h4>
                <div id="questionPalette" class="grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2"></div>
                <button onclick="confirmSubmit()" class="w-full mt-6 bg-red-600 text-white py-3 rounded font-bold">SUBMIT TEST</button>
            </div>
        </div>
    </div>

    <div id="resultSection" class="hidden-all p-6">
        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
            <h2 class="text-3xl font-bold text-center mb-8">Exam Result</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="text-center p-4 bg-blue-50 rounded">
                    <p class="text-sm">Total</p><p id="resTotal" class="text-xl font-bold">0</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <p class="text-sm">Correct</p><p id="resCorrect" class="text-xl font-bold">0</p>
                </div>
                <div class="text-center p-4 bg-red-50 rounded">
                    <p class="text-sm">Wrong</p><p id="resWrong" class="text-xl font-bold">0</p>
                </div>
                <div class="text-center p-4 bg-yellow-50 rounded">
                    <p class="text-sm">Score</p><p id="resScore" class="text-xl font-bold">0.00</p>
                </div>
            </div>
            <div id="wrongQuestionsList" class="space-y-4"></div>
            <button onclick="location.reload()" class="w-full mt-8 bg-blue-900 text-white py-3 rounded font-bold">New Test</button>
        </div>
    </div>

    <script>
        const CONFIG = {
            PASSWORD: '208025',
            SHEET_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-DLQLn-selNmHf2J8_Qp8cdOz8_YF0VUAMt1QxxePnK09bCAPDJvJznZndAuxuGr5E4UCQHZwhOkl/pub?output=csv'
        };

        let allQuestions = [], currentQuestions = [], userAnswers = [], questionStatus = [];
        let currentIndex = 0, timerInterval, timeRemaining = 0;

        function checkPass() {
            if (document.getElementById('sitePass').value === CONFIG.PASSWORD) {
                document.getElementById('passwordOverlay').classList.add('hidden-all');
                document.getElementById('loadingSection').classList.remove('hidden-all');
                loadData();
            } else {
                document.getElementById('passError').classList.remove('hidden');
            }
        }

        function loadData() {
            Papa.parse(CONFIG.SHEET_URL, {
                download: true, header: true, skipEmptyLines: true,
                complete: function(results) {
                    allQuestions = results.data.filter(q => q.Question);
                    populateSubjects();
                    document.getElementById('loadingSection').classList.add('hidden-all');
                    document.getElementById('subjectSection').classList.remove('hidden-all');
                }
            });
        }

        function populateSubjects() {
            const subjects = [...new Set(allQuestions.map(q => q.Subject))].filter(s => s).sort();
            const select = document.getElementById('mainSubject');
            subjects.forEach(s => select.innerHTML += `<option value="${s}">${s}</option>`);
        }

        function updateSubSubjects() {
            const subject = document.getElementById('mainSubject').value;
            const container = document.getElementById('subSubjectContainer');
            const subSelect = document.getElementById('subSubject');
            const subs = [...new Set(allQuestions.filter(q => q.Subject === subject).map(q => q['Sub-Subject'] || q.Topic))].filter(s => s);
            
            if(subs.length > 0) {
                container.classList.remove('hidden');
                subSelect.innerHTML = '<option value="">-- All Topics --</option>';
                subs.forEach(s => subSelect.innerHTML += `<option value="${s}">${s}</option>`);
            } else { container.classList.add('hidden'); }
        }

        function startExam() {
            const sub = document.getElementById('mainSubject').value;
            if(!sub) return alert('Select subject');
            const topic = document.getElementById('subSubject').value;
            const count = document.getElementById('questionCount').value;

            currentQuestions = allQuestions.filter(q => q.Subject === sub && (!topic || (q['Sub-Subject'] || q.Topic) === topic));
            currentQuestions = currentQuestions.sort(() => 0.5 - Math.random());
            if(count !== 'all') currentQuestions = currentQuestions.slice(0, parseInt(count));

            userAnswers = new Array(currentQuestions.length).fill(null);
            questionStatus = new Array(currentQuestions.length).fill('not-visited');
            
            document.getElementById('subjectSection').classList.add('hidden-all');
            document.getElementById('instructionSection').classList.remove('hidden-all');
        }

        function proceedToExam() {
            if(!document.getElementById('declaration').checked) return alert('Accept declaration');
            document.getElementById('instructionSection').classList.add('hidden-all');
            document.getElementById('examSection').classList.remove('hidden-all');
            timeRemaining = currentQuestions.length * 60;
            startTimer();
            renderQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                let h = Math.floor(timeRemaining / 3600), m = Math.floor((timeRemaining % 3600) / 60), s = timeRemaining % 60;
                document.getElementById('timer').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if(timeRemaining <= 0) finalSubmit();
            }, 1000);
        }

        function renderQuestion() {
            const q = currentQuestions[currentIndex];
            document.getElementById('qNumber').textContent = currentIndex + 1;
            document.getElementById('questionText').innerHTML = q.Question;
            if(questionStatus[currentIndex] === 'not-visited') questionStatus[currentIndex] = 'not-answered';

            const optDiv = document.getElementById('optionsContainer');
            optDiv.innerHTML = '';
            ['A','B','C','D'].forEach((opt, idx) => {
                const text = q[`Option ${opt}`] || q[opt] || q[`Option${opt}`];
                if(!text) return;
                const lbl = document.createElement('label');
                lbl.className = `option-label ${userAnswers[currentIndex] == idx+1 ? 'selected' : ''}`;
                lbl.innerHTML = `<input type="radio" name="opt" class="hidden" onchange="selectOption(${idx+1})"> <span class="font-bold mr-2">${opt}.</span> ${text}`;
                optDiv.appendChild(lbl);
            });
            renderPalette();
        }

        function selectOption(val) {
            userAnswers[currentIndex] = val;
            questionStatus[currentIndex] = 'answered';
            renderQuestion();
        }

        function renderPalette() {
            const pal = document.getElementById('questionPalette');
            pal.innerHTML = '';
            questionStatus.forEach((s, i) => {
                const b = document.createElement('button');
                b.className = `palette-btn palette-${s} ${i === currentIndex ? 'palette-current' : ''}`;
                b.textContent = i + 1;
                b.onclick = () => { currentIndex = i; renderQuestion(); };
                pal.appendChild(b);
            });
        }

        function saveAndNext() {
            if(currentIndex < currentQuestions.length - 1) { currentIndex++; renderQuestion(); }
            else { alert('This is the last question. You can submit now.'); }
        }

        function clearResponse() {
            userAnswers[currentIndex] = null;
            questionStatus[currentIndex] = 'not-answered';
            renderQuestion();
        }

        function markReviewAndNext() {
            questionStatus[currentIndex] = userAnswers[currentIndex] ? 'answered-marked' : 'marked';
            if(currentIndex < currentQuestions.length - 1) { currentIndex++; renderQuestion(); }
        }

        function confirmSubmit() {
            if(confirm('Do you want to submit the test?')) finalSubmit();
        }

        function finalSubmit() {
            clearInterval(timerInterval);
            document.getElementById('examSection').classList.add('hidden-all');
            document.getElementById('resultSection').classList.remove('hidden-all');
            
            let correct = 0, wrong = 0;
            currentQuestions.forEach((q, i) => {
                let ans = (q.Answer || '').toString().toLowerCase().trim();
                let map = { 'a':1, 'b':2, 'c':3, 'd':4, '1':1, '2':2, '3':3, '4':4 };
                if(userAnswers[i] == map[ans]) correct++;
                else if(userAnswers[i] != null) wrong++;
            });

            document.getElementById('resTotal').textContent = currentQuestions.length;
            document.getElementById('resCorrect').textContent = correct;
            document.getElementById('resWrong').textContent = wrong;
            document.getElementById('resScore').textContent = (correct - (wrong * 0.25)).toFixed(2);
        }
    </script>
</body>
</html>
